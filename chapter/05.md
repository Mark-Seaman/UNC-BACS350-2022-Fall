# Chapter 5 - Data

## Overview

- Skill 13 - Models & Database
- Skill 14 - CRUD Operations
- Skill 15 - Admin Views
- [Project 5 - Database - Superhero Refactored](../project/5)

![Chapter 5](img/chapter-5.jpg)

---

### Skill 13 - Models & Database

Old Lesson 12 - Data CRUD Operations
Visit the Django website
Applications = Data + Views
ORM - Object Relational Mapper
Database
Two Views of Data
Superhero Data Model
Data Migration


---



### Skill 14 - CRUD Operations

Old Lesson 12 - Data CRUD Operations
CRUD Operations
Operations on Every Model
Change in Demos
Book Builder App
Django Admin View
Start Book Builder project
Settings
Add Data Model
Enable Admin Views on Book
Test Admin Book
Python CRUD
Practice
CRUD Code
Data Model
CREATE
READ
UPDATE
DELETE

---



### Skill 15 - Admin Views

Old Lesson 10 - Admin Views
Week 4 - Data
Data Models
Admin views
Hero Data Model
Migration
Development Database
Templates
Views
URLs
Test and fix
Data Model
Admin Views
Fix display of Hero 
Django Tests
Tests

Lesson 14 - Manipulating Data
Week 5 - Data
Project 4
Project 5
Data Models
Data Migrations
CRUD
Django Shell
Data Model
CREATE
READ - List
READ - Get
UPDATE
DELETE
Test CRUD
Test Each Operation
Use the Query Functions
You practice

---

### [Project 4 - Superhero Profiles](../project/4)

---

SKILL 13

---


### Visit the Django website
* [Django Website](https://www.djangoproject.com/)
* [Django Start](https://www.djangoproject.com/start)
* Select the "Object-relational Mapper" expansion link


### Applications = Data + Views + Tests
* Static Websites are views without data
* Data is saved state on the server


### ORM - Object Relational Mapper
* Create Python Classes
* Automatically create Database Tables


### Database
* Rows and Columns
* Items and Attributes


### Two Views of Data
* Objects in Memory
* Database Rows


### Book Data Model
* Book
    * Title
    * Author


### Data Migration
* Examine Python Data Models
* Create scripts to migrate the database tables


### CRUD Operations
* CREATE - make a new record
* READ - get one or more records (List, Detail)
* UPDATE - modify an existing record
* DELETE - remove a record


### Operations on Every Model
* Create Book
* List Book
* Details Book
* Update Book
* Delete Book


### Project 5 - Superhero Database

### Superhero Data Model
* Superhero
    * Name
    * Description
    * Image


### Book Builder App
* Simple enough to teach principles
* Complex enough to demonstrate key ideas
* Every week we will build features
* Projects 1-14 will build Superhero News Service


### Django Admin View
* Build a UI to manipulate data
* Free and easy
* Create new table in five minutes


### Start Book Builder project

    $ cd week5/BookBuilder
    $ django-admin startproject config .
    $ python manage.py startapp book


### Add Data Model

    class Book(models.Model):
        title = models.CharField(max_length=200)
        author = models.CharField(max_length=200)

    $ python manage.py makemigrations
    $ python manage.py migrate


### Python CRUD

Terminal Window

    $ python manage.py shell

Use the Book Model

    from book.models import Book

List Books

    Book.objects.all()

    Book.objects.filter(author='Mark Seaman')

Get specific book

    b = Book.objects.get(title="A Seaman's Journey")
    b.author
    b.name
    b.pk

Create book record

    Book.objects.create(title="A Seaman's Journey", author="Mark Seaman")

Update book record

    b = Book.objects.get(title="A Seaman's Journey")
    b.title = "A Seaman's Life"
    b.save()
    
Delete a record
    
    Book.objects.get(title="A Seaman's Journey").delete()

### Practice
* Start a new project "week5/Superhero"
* Implement the Hero model and admin views
* Run the Django shell
* Experiment with creating, listing, modifying objects


### CRUD Code
* CREATE - Superhero.objects.create()
* READ - Superhero.objects.get()
* UPDATE - hero.save()
* DELETE - hero.delete()


### Data Model
* Superhero (name, description='None', image='None')

hero/models.py

    class Superhero(models.Model):
        name = models.CharField(max_length=200)
        description = models.TextField()
        image = models.CharField(max_length=200)


### CREATE

    Superhero.objects.create(name='Black Widow', description='Natalia Romanova', image='None')
    
    
### READ

    w = Superhero.objects.get(name='Black Widow')
    print(w.description)
    
    for s in Superhero.objects.all():
        print(w.description, w.name)
   

### UPDATE

    w = Superhero.objects.get(name='Black Widow')
    w.description='Natasha Romanoff'
    w.save()
    

### DELETE

    Superhero.objects.get(name='Black Widow').delete()



---

SKILL 14

---

---

SKILL 15

---

### Enable Admin Views on Book

book/admin.py

    from django.contrib import admin
    from .models import Book

    admin.site.register(Book)


### Test Admin Book

    $ python manage.py createsuperuser
    $ python manage.py runserver
    $ browse to 127.0.0.1:8000/admin/
    $ git add . && git commit -m "Book Data Model"


### App Platform Deployment

Run Command

    python manage.py migrate --no-input
    python manage.py createsuperuser --no-input --email 'me@here.us' --username seaman --password seaman
    gunicorn --worker-tmp-dir /dev/shm config.wsgi

The reason python manage.py createsuperuser --noinput --email <youremail> works, 
has to do with DJANGO_SUPERUSER_USERNAME, and DJANGO_SUPERUSER_PASSWORD in your 
app-level environment variables (see docs).

---

PROJECT 5

---

### Project 5 - Superhero Database

* Start a new project "week5/Superhero"
* Implement the Hero model and database
* Run the Django shell
* Experiment with creating, listing, modifying objects
* Implement the admin views


### Development Workflow
* Pull 
* Change
* Test Locally
* Commit & Deploy
* Test Remotely


### Start a new project

    $ cd week5/Superhero
    $ django-admin startproject config .
    $ python manage.py startapp hero


### Settings

config/settings.py

    ALLOWED_HOSTS = ['*']

    INSTALLED_APPS = [
        'django.contrib.admin',
        'django.contrib.auth',
        'django.contrib.contenttypes',
        'django.contrib.sessions',
        'django.contrib.messages',
        'django.contrib.staticfiles',
        'hero',
    ]

    TEMPLATES = [
        {
            ...
            'DIRS': [BASE_DIR / 'templates'],
            ...
        },
    ]

    STATIC_URL = '/static/'
    STATICFILES_DIRS = [BASE_DIR / "static"]



### Data Model

Superhero Data Record

    name
    description
    image

hero/models.py

    class Superhero(models.Model):
        name = models.CharField(max_length=200)
        description = models.TextField()
        image = models.CharField(max_length=200)


### CRUD Code
* CREATE - Superhero.objects.create()
* READ - Superhero.objects.get(), Superhero.objects.filter()
* UPDATE - hero.save()
* DELETE - hero.delete()


### CREATE

    Superhero.objects.create(name='Black Widow', description='Natalia Romanova', image='None')
    
    
### READ

    w = Superhero.objects.get(name='Black Widow')
    print(w.description)
    
    for s in Superhero.objects.all():
        print(w.description, w.name)
   

### UPDATE

    w = Superhero.objects.get(name='Black Widow')
    w.description='Natasha Romanoff'
    w.save()
    

### DELETE

    Superhero.objects.get(name='Black Widow').delete()



