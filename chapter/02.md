# Chapter 2 - Application Hosting

* Skill 4 - Deploy a Static Web Server
* Skill 5 - Deploy Django App Server
* Skill 6 - Database Server
* [Project 2 - Application Deployment](../project/2)

![Chapter 2](img/chapter-2.jpg)

### Digital Ocean

* Web hosting at Digital Ocean
* Platform as a Service
    * Operating System
    * Python 3.10
    * Django 
    * MySQL database
    * Droplets
    * Docker containers


### App Platform
* GUI to build server platform
* Automatic maintenance of platform (OS, Python, Libraries, Database)
* $5/month  ($50 credit)
* Automatic deployment


### Python Anywhere
* Last year we used Python Anywhere
* Some difficulty for students
* App Platform will require no ongoing maintenance


### Django Application
* Python code (URL routes, Views, Database, Business Logic)
* Maps each request to a response
* Executes Python code


### Static Web Server
* File lookup and return as response
* No program execution on server
* Types of files
    * HTML files
    * JavaScript files (runs on client)
    * Images
    * Video


### Django App Hosting
* Django App Server
* Static Asset Server
* Database Server


### Deploying on Digital Ocean
* Sign up for account
* Create a static web server (Free Account)
* Create a Django app server (Basic Account $5/month)
* Create a Database server ($7/month)


### Database
* Minimal cost $12/month for database
* Use development database (until week 4)
* Data will be destroyed during deployment


---

## Skill 4 - Deploy a Static Web Server

### Sign up for Account

### Build Django Repo
* Start with Shrinking-World-Website
* Clone repo
* Test static website at "/index.html"
* Edit the text in the website
* Commit and push

### Create Static Server
* Apps, Create App
* Resources 
    - Connect to Github account
    - Find repo
    - Github repo, main, /, autodeploy
* Environment vars
* Info
* Review



## Skill 5 - Deploy Django App Server

### Build Django Repo
* Start with Shrinking-World-Django-App
* Clone repo
* Test static website
* Test django pages

### Create Static Server
* Apps, Create App
* Resources 
    - Connect to Github account
    - Find repo
    - Github repo, main, /static, autodeploy
* Environment vars
* Info
* Review


### Create Django Server
* Apps, Create App
* Resources - Github repo, main, /, autodeploy
* Environment vars
* Info
* Review



## Skill 6 - Database

### Delay Production Database
* Use development database (until week 4)
* "python manage.py migrate" creates database
* Creates "sqlite3.db"
* Add to Github
* Deploy on server (old data is replaced)

### Upgrade to Production Database
* Minimal cost $7/month for database
* Data will be destroyed during deployment

### Data Models
- ORM - Object Relational Mapping
- Data Models define the table structure
- Database tables are created by code


### Hero Data Model

hero/models.py

    from django.db import models

    class Hero (models.Model):
        name = models.CharField(max_length=100)
        description = models.TextField()
        image = models.CharField(max_length=200)


### Migration
Examine code for changes to Data Models

    $ python manage.py makemigrations

Apply changes to Data Tables

    $ python manage.py migrate



### Short-cuts
* Sensei
* Github repo
* Web app
* Python Anywhere config
* Python Anywhere console


### Development Workflow
* Pull code
* Make changes
* Test changes
* Push changes
* Deploy


### Pull code
Before you start working

    $ git pull


### Make changes
* Work in small steps
* One feature at a time
* Test and fix
* Commit frequently (10-20 minutes)


### Test changes
* Change code and refresh browser
* Editor, Terminal, Browser all visible

### Commit changes
Commit and push each hour

    $ git add . 
    $ git commit -m 'Week 4 - admin views'
    $ git push


### Create Project

    $ cd BACS350; mkdir week4/Superhero && cd week4/Superhero
    $ django-admin startproject config .
    $ python manage.py startapp hero
    $ python manage.py runserver


### Settings

config/settings.py

    # Enable the templates for the 'templates' directory

    TEMPLATES = [
        {
            ...
            'DIRS': ['templates'],
            ...
        },
    ]


    # Enable the static media server (Images, CSS, Javascript)

    STATIC_URL = '/static/'
    STATICFILES_DIRS = [BASE_DIR / "static"]


    # Enable Python Anywhere

    ALLOWED_HOSTS = ['markseaman.pythonanywhere.com', '127.0.0.1']


    # Enable data for Hero app

    INSTALLED_APPS = [
        'django.contrib.admin',
        'django.contrib.auth',
        'django.contrib.contenttypes',
        'django.contrib.sessions',
        'django.contrib.messages',
        'django.contrib.staticfiles',
        'hero',
    ]



### Templates

templates/index.html

    <h1>Superhero Gallery</h1>

    <a href="/admin/">Django Admin Views</a>


### Views

hero/views.py

    from django.views.generic import TemplateView

    class IndexView(TemplateView):
        template_name = 'index.html'



### URLs

config/urls.py

    from django.urls import path
    from hero.views import IndexView
    from django.contrib import admin

    urlpatterns = [
        path('admin/', admin.site.urls),
        path('', IndexView.as_view()),
    ]


### Test and fix

Test the app

    $ python manage.py runserver
    $ browse to 127.0.0.1:8000

Create a super user

    $ python manage.py createsuperuser


### Django Tests

hero/tests.py

    from django.test import SimpleTestCase

    class SimpleTests(SimpleTestCase):
        def test_home_page_status_code(self):
            response = self.client.get('/')
            self.assertEqual(response.status_code, 200)

Run all tests

    $ python manage.py test


### Python Anywhere Setup
* Two Alternatives
    - App Environment created by Web App wizard
    - Use mkvirtualenv to control environment
* Delete the existing app


### Create Virtual Environment
* Create an isolated python environment
    * mkvirtualenv --python=/usr/bin/python3.8 .venv
* Install Django in the environment
    * pip install django


### Delete Your Web App
* Use the Python Anywhere Web App page
* Delete Web App
* Add New Web App "temp"
* Switch settings to "week4/Superhero"


### Switching Web Apps
* Code
    * Source Code - /home/markseaman/BACS350/week4/Superhero
    * Working Directory - /home/markseaman/BACS350/week4/Superhero
* WSGI 
    * project_home = '/home/markseaman/BACS350/week4/Superhero'
    * os.environ['DJANGO_SETTINGS_MODULE'] = 'config.settings'
* Static files - /home/markseaman/BACS350/week4/Superhero/static


---

## Skill 6 - Static Web Server

### Class-based views
* Defines all of the view logic as a Python object class
* Override any behavior you wish
* TemplateView shows an HTML template as a view
* Design patterns for custom Django views


### TemplateView template

templates/hulk.html

    <h1>Hulk Profile</h1>
  
    <img src="hulk.jpg" alt="Hulk">

### TemplateView views.py

views.py

    from django.views.generic import TemplateView
    
    class HulkView(TemplateView):
        template_name = 'hulk.html'

        
### TemplateView urls.py

urls.py

    from django.urls import path
    from django.views.generic import HulkView, WidowView
    
    urlpatterns = [
        path('hulk', HulkView.as_view()),
    ]


### Templates with Images

templates/hulk.html

    <h1>Hulk Profile</h1>
    <img src="hulk.jpg" alt="Hulk">
  

templates/black_widow.html

    <h1>Black Widow</h1>
    <img src="black_widow.jpg" alt="Hulk">

urls.py

    from django.urls import path
    from django.views.generic import HulkView, WidowView
    
    urlpatterns = [
        path('hulk', HulkView.as_view()),
        path('black_widow', WidowView.as_view()),
    ]

pages/views.py

    from django.views.generic import TemplateView
    
    class HulkView(TemplateView):
        template_name = 'hulk.html'

    class WidowView(TemplateView):
        template_name = "black_widow.html"
        
templates/

    hulk.jpg
    black_widow.jpg
    
 
### Pages may Contain Images
* Django serves pages expected to be processed
* Static content is passed directly through without processing
* Django contains a static server that can be enabled

   
### Add Custom Django Views

static/images/

    hulk.jpg
    black_widow.jpg

templates/hulk.html

    <h1>Hulk Profile</h1>
    <img src="/static/images/hulk.jpg" alt="Hulk">
  

templates/black_widow.html

    <h1>Black Widow</h1>
    <img src="/static/images/black_widow.jpg" alt="Hulk">
    

### settings.py
* STATIC_URL = '/static/'
* STATICFILES_DIRS = [os.path.join(BASE_DIR, 'static'),]


### Images, CSS, Javascript
* < img src='/static/img/treetops.200.jpg' >
* < link rel='stylesheet' href='/static/unc.css' >
* < script href='/static/wow.js' >
      
  
### Add Data to Django Views
    
templates/hero.html

    <h1>Hero: {{ hero }}</h1>
    <img src="/static/images/{{ hero }}.jpg" alt="{{ hero }}">


### Data as dictionary

Define what goes in the variable slots

    {
        'hero': 'hulk', 
    }
    
    {
        'hero': 'black_widow', 
    }


### Hero View
    
pages/views.py
    
     class HulkView(TemplateView):
        template_name = 'hero.html'
        
        def get_context_data(self, **kwargs):
            return { 'hero': 'hulk' }
               
     
     class WidowView(TemplateView):
        template_name = "hero.html"
        
        def get_context_data(self, **kwargs):
            return { 'hero': 'black_widow' }


### Demo Code in Github
* [Mark-Seaman/BACS350](https://github.com/Mark-Seaman/BACS350/tree/main/week2/Superhero)
* Look at my code after you create your own
* You learn by doing - practice makes perfect


### Exercise
* Start with my code
* Build a new view template, "profile.html"
* Create a URL route, "profile" that shows the view
* Add a home link to the page template
* Define the context for all pages to take you home
* Create template with HTML that validates 



### [Project 2 - Application Deployment](../project/2)

